name: umi-amplicon CI
# This workflow runs the pipeline with the minimal test dataset to check that it completes without error
on:
  push:
  pull_request:
  release:
    types: [published]

env:
  NXF_ANSI_LOG: false
  CAPSULE_LOG: none

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # Nextflow versions
        include:
          - NXF_VER: '23.04.0'
            NXF_EDGE: ''
          - NXF_VER: '23.10.0'
            NXF_EDGE: ''
          - NXF_VER: '24.04.1'
            NXF_EDGE: ''

    steps:
      - name: Check out pipeline code
        uses: actions/checkout@v4
      
      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'  

      - name: Install Nextflow
        run: |
          wget -qO- https://get.nextflow.io | bash
          sudo mv nextflow /usr/local/bin/
          nextflow -version

      # - name: Install Docker
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y docker.io
      #     sudo systemctl start docker
      #     sudo usermod -aG docker $USER

      - name: Run pipeline with test data
        run: |
          nextflow run ${GITHUB_WORKSPACE} -profile test,docker --outdir ./results

      # - name: Run pipeline with test_full data
      #   run: |
      #     nextflow run ${GITHUB_WORKSPACE} -profile test_full,docker --outdir ./results_full

