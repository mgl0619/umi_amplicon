/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {

    // NOTE: This config applies to FASTP when called without an alias
    // FASTP_QC and FASTP_TRIM in UMI_ANALYSIS_SUBWORKFLOW have their own configs in modules.config
    withName: 'FASTP' {
        ext.args = { [
            // Read merging (only for default FASTP, NOT for FASTP_QC)
            '--merge',
            '--overlap_len_require 10',
            '--overlap_diff_limit 5',
            '--overlap_diff_percent_limit 20',
            '--correction',
            
            // Quality filtering
            "--qualified_quality_phred ${params.fastp_qualified_quality}",
            "--cut_mean_quality ${params.fastp_cut_mean_quality}",
            '--cut_front',
            '--cut_tail',
            '--cut_window_size 4',
            
            // Adapter detection and trimming
            '--detect_adapter_for_pe',
            
            // Other options
            '--length_required 50',
            '--n_base_limit 5'
        ].join(' ').trim() }
        
        publishDir = [
            [
                path: { "${params.outdir}/fastp" },
                mode: params.publish_dir_mode,
                pattern: "*.{json,html,log}"
            ],
            [
                path: { "${params.outdir}/fastp/merged" },
                mode: params.publish_dir_mode,
                pattern: "*.merged.fastq.gz",
                enabled: params.fastp_save_merged
            ],
            [
                path: { "${params.outdir}/fastp/failed" },
                mode: params.publish_dir_mode,
                pattern: "*.fail.fastq.gz",
                enabled: params.fastp_save_trimmed_fail
            ]
        ]
    }

}
