/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    nf-core/umi-amplicon modules configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Configuration for nf-core/umi-amplicon modules
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {
    publishDir = [
        [
            path: { "${params.outdir}/" },
            mode: params.publish_dir_mode,
            pattern: '*.{html,txt,log}'
        ]
    ]

    withName: 'UMI_QC_METRICS' {
        ext.args = [
            '--umi_length', params.umi_length,
            '--quality_threshold', params.umi_quality_threshold,
            '--collision_rate_threshold', params.umi_collision_rate_threshold,
            '--diversity_threshold', params.umi_diversity_threshold
        ].join(' ')
        publishDir = [
            [
                path: { "${params.outdir}/umi_qc" },
                mode: params.publish_dir_mode,
                pattern: '*.{html,txt,log,csv}'
            ]
        ]
    }

    withName: 'UMI_EXTRACT' {
        ext.args = [
            '--pattern', params.umi_pattern,
            '--method', params.umi_method
        ].join(' ')
        publishDir = [
            [
                path: { "${params.outdir}/umi_extract" },
                mode: params.publish_dir_mode,
                pattern: '*.{fastq,fastq.gz,txt,log}'
            ]
        ]
    }

    withName: 'UMI_DEDUP' {
        publishDir = [
            [
                path: { "${params.outdir}/umi_dedup" },
                mode: params.publish_dir_mode,
                pattern: '*.{fastq,fastq.gz,txt,log}'
            ]
        ]
    }

    withName: 'UMI_ANALYSIS' {
        ext.args = [
            '--method', params.umi_method
        ].join(' ')
        publishDir = [
            [
                path: { "${params.outdir}/umi_analysis" },
                mode: params.publish_dir_mode,
                pattern: '*.{html,txt,log,csv,json}'
            ]
        ]
    }

    withName: 'HTML_REPORT' {
        publishDir = [
            [
                path: { "${params.outdir}/report" },
                mode: params.publish_dir_mode,
                pattern: '*.{html,txt,log}'
            ]
        ]
    }
}
